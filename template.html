<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>英語・日本語セリフ比較</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .dialogue {
            display: flex;
            margin-bottom: 20px;
            padding: 10px;
            border-bottom: 1px solid #eee;
            transition: background-color 0.2s;
        }
        .dialogue:hover {
            background-color: #f5f5f5;
        }
        .text {
            flex: 1;
            white-space: pre-wrap;
            padding: 10px;
            cursor: pointer;
        }
        .japanese-debug {
            flex: 1;
            white-space: pre-wrap;
            padding: 10px;
            border-left: 1px solid #eee;
            color: #666;
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        .instructions {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
            font-style: italic;
        }
        .button {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 5px 10px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 4px;
        }
        .button:hover {
            background-color: #45a049;
        }
        .hidden-japanese {
            display: none;
        }
    </style>
    <script>
        const japaneseTexts = {{.JapaneseTexts}};
        const japaneseIndices = new Map();
        const pageSize = 10; // 1ページあたりのダイアログ数

        function toggleText(element) {
            const english = element.getAttribute('data-english');
            const japanese = element.getAttribute('data-japanese');
            const textElement = element.querySelector('.text');
            const currentText = textElement.textContent.trim();
            
            if (currentText === english) {
                textElement.textContent = japanese;
            } else {
                textElement.textContent = english;
            }
        }

        function getCurrentPage(index) {
            return Math.floor(index / pageSize);
        }

        function loadNextJapanese(element) {
            const index = parseInt(element.getAttribute('data-index'));
            const textElement = element.querySelector('.text');
            const japaneseDebugElement = element.querySelector('.japanese-debug');
            
            // 現在のインデックスを取得（初期値は0）
            let currentIndex = japaneseIndices.get(index) || 0;
            const currentPage = getCurrentPage(index);
            
            // 次の日本語テキストを取得
            if (currentIndex + 1 < japaneseTexts.length) {
                const nextJapanese = japaneseTexts[currentIndex + 1];
                
                // 現在の日本語テキストを取得
                const currentJapanese = element.getAttribute('data-japanese');
                
                // 新しい日本語テキストを作成（現在のテキスト + 改行 + 次のテキスト）
                const newJapanese = currentJapanese + '\n' + nextJapanese;
                
                // テキストを更新
                textElement.textContent = newJapanese;
                japaneseDebugElement.textContent = newJapanese;
                element.setAttribute('data-japanese', newJapanese);
                
                // インデックスを更新
                japaneseIndices.set(index, currentIndex + 1);

                // 同じページ内の後続のダイアログの日本語テキストをずらす
                const dialogues = document.querySelectorAll('.dialogue');
                for (let i = index + 1; i < dialogues.length; i++) {
                    if (getCurrentPage(i) === currentPage) {
                        const dialogue = dialogues[i];
                        const currentIndex = japaneseIndices.get(i) || i;
                        const nextIndex = currentIndex + 1;
                        if (nextIndex < japaneseTexts.length) {
                            const nextText = japaneseTexts[nextIndex];
                            console.log(`Updating dialogue ${i}: currentIndex=${currentIndex}, nextIndex=${nextIndex}, nextText=${nextText}`);
                            dialogue.setAttribute('data-japanese', nextText);
                            const debugElement = dialogue.querySelector('.japanese-debug');
                            if (debugElement) {
                                debugElement.textContent = nextText;
                                console.log(`Updated debug element for dialogue ${i}`);
                            } else {
                                console.log(`Debug element not found for dialogue ${i}`);
                            }
                            japaneseIndices.set(i, nextIndex);
                        }
                    } else {
                        break; // 別のページに到達したら終了
                    }
                }
            }
        }

        // 初期化時に各ダイアログのインデックスを設定
        document.addEventListener('DOMContentLoaded', function() {
            const dialogues = document.querySelectorAll('.dialogue');
            dialogues.forEach((dialogue, index) => {
                // インデックスを設定
                japaneseIndices.set(index, index);
                
                // 初期の日本語テキストを設定
                const initialJapanese = japaneseTexts[index];
                dialogue.setAttribute('data-japanese', initialJapanese);
                
                // デバッグ表示を更新
                const japaneseDebugElement = dialogue.querySelector('.japanese-debug');
                japaneseDebugElement.textContent = initialJapanese;
            });
        });
    </script>
</head>
<body>
    <h1>英語・日本語セリフ比較</h1>
    <div class="instructions">クリックで英語と日本語を切り替え、ボタンで次の日本語を追加</div>
    {{range $index, $dialogue := .Dialogues}}
    <div class="dialogue" data-index="{{$index}}" data-english="{{$dialogue.English}}" data-japanese="{{$dialogue.Japanese}}">
        <div class="text" onclick="toggleText(this.parentElement)">{{$dialogue.English}}</div>
        <div class="japanese-debug">{{$dialogue.Japanese}}</div>
        <button class="button" onclick="loadNextJapanese(this.parentElement)">次の日本語</button>
    </div>
    {{end}}
    <div class="hidden-japanese">
        {{range $index, $text := .JapaneseTexts}}
        <div data-japanese-index="{{$index}}">{{$text}}</div>
        {{end}}
    </div>
</body>
</html> 